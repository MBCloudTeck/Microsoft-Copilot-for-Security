let threshold = 5;
AADNonInteractiveUserSignInLogs
| where ResultType != 0
| summarize FailedAttempts = count() by IPAddress, UserPrincipalName
| where FailedAttempts > threshold
| join kind=leftouter (
    AADNonInteractiveUserSignInLogs
    | where ResultType != 0
    | project IPAddress, UserPrincipalName, TimeGenerated, AppDisplayName, Location, MfaDetail, UserAgent, AuthenticationProcessingDetails
) on IPAddress, UserPrincipalName
| project IPAddress, UserPrincipalName, FailedAttempts, TimeGenerated, AppDisplayName, Location, MfaDetail, UserAgent, AuthenticationProcessingDetails
